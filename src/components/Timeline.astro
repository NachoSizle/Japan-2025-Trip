---
import DayCard from './DayCard.astro';
import itinerarioData from '../data/itinerario.json';

const { dias } = itinerarioData;
---

<section id="itinerario" class="py-12 sm:py-16 md:py-20 timeline-section">
  <div class="container mx-auto px-2 sm:px-4">
    <!-- Header de la secci√≥n -->
    <div class="text-center mb-8 sm:mb-12 md:mb-16">
      <h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold font-poppins mb-3 sm:mb-4 md:mb-6 timeline-title">
        Itinerario Completo
      </h2>
      <p class="text-base sm:text-lg md:text-xl timeline-subtitle max-w-3xl mx-auto mb-4 sm:mb-6 md:mb-8 px-2 sm:px-4">
        Explora d√≠a a d√≠a nuestra aventura por Jap√≥n, con opciones especiales para cel√≠acos en cada parada.
      </p>
      
      <!-- Filtros optimizados para m√≥vil -->
      <div class="flex flex-wrap justify-center gap-1 sm:gap-2 md:gap-4 mb-6 sm:mb-8 px-2" x-data="{ activeFilter: 'todos' }">
        <button 
          @click="activeFilter = 'todos'" 
          :class="activeFilter === 'todos' ? 'filter-active-primary' : 'filter-inactive-primary'"
          class="px-2 sm:px-3 md:px-6 py-1.5 sm:py-2 border-2 rounded-full font-medium transition-all duration-300 text-xs whitespace-nowrap flex-shrink-0">
          Todos los d√≠as
        </button>
        <button 
          @click="activeFilter = 'gluten-free'" 
          :class="activeFilter === 'gluten-free' ? 'filter-active-gluten' : 'filter-inactive-gluten'"
          class="px-2 sm:px-3 md:px-6 py-1.5 sm:py-2 border-2 rounded-full font-medium transition-all duration-300 text-xs whitespace-nowrap flex-shrink-0">
          üåæüö´ Sin Gluten
        </button>
        <button 
          @click="activeFilter = 'destacados'" 
          :class="activeFilter === 'destacados' ? 'filter-active-featured' : 'filter-inactive-featured'"
          class="px-2 sm:px-3 md:px-6 py-1.5 sm:py-2 border-2 rounded-full font-medium transition-all duration-300 text-xs whitespace-nowrap flex-shrink-0">
          ‚≠ê Destacados
        </button>
        <button 
          @click="activeFilter = 'turismo'" 
          :class="activeFilter === 'turismo' ? 'filter-active-tourism' : 'filter-inactive-tourism'"
          class="px-2 sm:px-3 md:px-6 py-1.5 sm:py-2 border-2 rounded-full font-medium transition-all duration-300 text-xs whitespace-nowrap flex-shrink-0">
          üóº Turismo
        </button>
      </div>
    </div>

    <!-- Timeline principal optimizada para m√≥vil -->
    <div class="relative">
      <!-- L√≠nea de tiempo vertical - m√°s visible en m√≥vil -->
      <div class="timeline-line absolute left-4 sm:left-8 md:left-1/2 top-0 bottom-0 w-0.5 sm:w-1 transform md:-translate-x-1/2 rounded-full"></div>
      
      <!-- Tarjetas de d√≠as optimizadas para m√≥vil -->
      <div class="space-y-6 sm:space-y-8 md:space-y-12">
        {dias.map((dia, index) => {
          // Crear atributos data para que Alpine.js pueda usarlos
          const hasGlutenFree = dia.actividades.some((act: any) => act.gluten_free === true);
          const hasDestacado = dia.actividades.some((act: any) => act.destacado === true);
          const hasTurismo = dia.actividades.some((act: any) => act.tipo === 'turismo');
          
          // Determinar si es par o impar para el zig-zag (empezando izquierda = √≠ndice par)
          const isLeft = index % 2 === 0;
          
          return (
            <div 
              class="relative"
              x-show={`
                activeFilter === 'todos' || 
                (activeFilter === 'gluten-free' && ${hasGlutenFree}) ||
                (activeFilter === 'destacados' && ${hasDestacado}) ||
                (activeFilter === 'turismo' && ${hasTurismo})
              `}
              x-transition:enter="transition ease-out duration-300"
              x-transition:enter-start="opacity-0 transform scale-95"
              x-transition:enter-end="opacity-100 transform scale-100"
              x-transition:leave="transition ease-in duration-200"
              x-transition:leave-start="opacity-100 transform scale-100"
              x-transition:leave-end="opacity-0 transform scale-95">
              
              <!-- Punto de conexi√≥n en la timeline - optimizado para m√≥vil -->
              <div class="timeline-dot absolute left-4 sm:left-8 md:left-1/2 w-3 h-3 sm:w-4 sm:h-4 rounded-full transform md:-translate-x-1/2 border-2 sm:border-4 z-10 animate-pulse"></div>
              
              <!-- Enlace a p√°gina individual del d√≠a -->
              <a href={`${import.meta.env.BASE_URL}/itinerario/${dia.dia}`} class="block group">
                <!-- Tarjeta - layout m√≥vil first con zig-zag desktop -->
                <div class={`ml-8 sm:ml-12 md:ml-0 md:w-5/12 md:max-w-lg ${isLeft ? 'md:mr-auto md:pr-6 lg:pr-8' : 'md:ml-auto md:pl-6 lg:pl-8'}`}>
                  <DayCard 
                    day={dia.dia}
                    fecha={dia.fecha}
                    titulo={dia.titulo}
                    ciudad={dia.ciudad}
                    actividades={dia.actividades}
                  />
                  <!-- Indicador de que es clickeable -->
                  <div class={`mt-2 transition-colors duration-300 ${isLeft ? 'text-center md:text-left' : 'text-center md:text-right'}`}>
                    <span class="text-xs clickable-hint">
                      üëÜ Toca para ver detalles completos
                    </span>
                  </div>
                </div>
              </a>
            </div>
          );
        })}
      </div>
    </div>

    <!-- Stats del viaje optimizadas para m√≥vil -->
    <div class="mt-8 sm:mt-12 md:mt-16 lg:mt-20 grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4 md:gap-6 lg:gap-8 text-center px-1">
      <div class="timeline-stat-card p-2 sm:p-4 md:p-6 rounded-lg sm:rounded-xl transition-all duration-300">
        <div class="stat-number text-lg sm:text-2xl md:text-3xl font-bold mb-1 sm:mb-2" style="color: #FF1493; text-shadow: 0 0 10px rgba(255, 20, 147, 0.5);">{itinerarioData.viaje.duracion_dias}</div>
        <div class="stat-label text-xs sm:text-sm">D√≠as totales</div>
      </div>
      <div class="timeline-stat-card p-2 sm:p-4 md:p-6 rounded-lg sm:rounded-xl transition-all duration-300">
        <div class="stat-number text-lg sm:text-2xl md:text-3xl font-bold mb-1 sm:mb-2" style="color: #FF6B6B; text-shadow: 0 0 10px rgba(255, 107, 107, 0.5);">{itinerarioData.viaje.ciudades_principales.length}</div>
        <div class="stat-label text-xs sm:text-sm">Ciudades</div>
      </div>
      <div class="timeline-stat-card p-2 sm:p-4 md:p-6 rounded-lg sm:rounded-xl transition-all duration-300">
        <div class="stat-number text-lg sm:text-2xl md:text-3xl font-bold mb-1 sm:mb-2" style="color: #FF0040; text-shadow: 0 0 10px rgba(255, 0, 64, 0.5);">
          {dias.reduce((total, dia) => total + dia.actividades.filter(a => a.tipo === 'comida').length, 0)}
        </div>
        <div class="stat-label text-xs sm:text-sm">Experiencias gastron√≥micas</div>
      </div>
      <div class="timeline-stat-card p-2 sm:p-4 md:p-6 rounded-lg sm:rounded-xl transition-all duration-300 col-span-2 lg:col-span-1">
        <div class="stat-number text-lg sm:text-2xl md:text-3xl font-bold mb-1 sm:mb-2" style="color: #FF8A80; text-shadow: 0 0 10px rgba(255, 138, 128, 0.5);">
          {dias.reduce((total, dia) => total + dia.actividades.filter(a => a.gluten_free).length, 0)}
        </div>
        <div class="stat-label text-xs sm:text-sm">Opciones GF</div>
      </div>
    </div>

    <!-- CTA para m√°s informaci√≥n - optimizado para m√≥vil -->
    <div class="text-center mt-8 sm:mt-12 md:mt-16 px-2 sm:px-4">
      <a href="#gluten-free" class="timeline-cta inline-flex items-center justify-center space-x-2 px-6 sm:px-8 py-3 sm:py-4 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 text-sm sm:text-base min-w-0">
        <span class="text-lg">üåæ</span>
        <span class="whitespace-nowrap">Ver Gu√≠a Sin Gluten</span>
        <span class="text-lg">üö´</span>
      </a>
    </div>
  </div>
</section>

<style>
  /* Timeline Section */
  .timeline-section {
    background: linear-gradient(135deg, #1a1a1a 0%, #2d1b3d 100%);
    position: relative;
  }
  
  :global(:global([data-theme="light"])) .timeline-section {
    background: linear-gradient(135deg, #ffeef7 0%, #f8f0ff 100%) !important;
  }

  /* Timeline Title */
  .timeline-title {
    background: linear-gradient(135deg, #FF1493, #FF6B6B, #FF0040);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 30px rgba(255, 20, 147, 0.5);
  }

  /* Timeline Subtitle */
  .timeline-subtitle {
    color: rgba(255, 255, 255, 0.8);
  }
  
  /* ===== ESTILOS PARA MODO CLARO ===== */
  :global(:global([data-theme="light"])) .timeline-title {
    background: linear-gradient(135deg, #FF1493, #FF6B6B, #FF0040) !important;
    -webkit-background-clip: text !important;
    background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    text-shadow: 0 0 20px rgba(255, 20, 147, 0.3) !important;
  }
  
  :global(:global([data-theme="light"])) .timeline-subtitle {
    color: rgba(80, 50, 80, 0.9) !important;
  }

  /* Timeline Line */
  .timeline-line {
    background: linear-gradient(to bottom, #FF1493, #FF6B6B, #FF0040);
    opacity: 0.6;
  }
  
  :global([data-theme="light"]) .timeline-line {
    background: linear-gradient(to bottom, #FF1493, #FF6B6B, #FF0040);
    opacity: 0.4;
  }

  /* Timeline Dot */
  .timeline-dot {
    background: #FF1493;
    border-color: #1a1a1a !important;
    box-shadow: 0 0 15px rgba(255, 20, 147, 0.8);
  }
  
  :global([data-theme="light"]) .timeline-dot {
    background: #FF1493;
    border-color: #ffeef7 !important;
    box-shadow: 0 0 15px rgba(255, 20, 147, 0.6);
  }

  /* Filter Buttons */
  .filter-active-primary {
    background: #FF1493 !important;
    color: white !important;
    border-color: #FF1493 !important;
    box-shadow: 0 0 20px rgba(255, 20, 147, 0.6);
  }

  .filter-inactive-primary {
    background: transparent !important;
    color: #FF1493 !important;
    border-color: #FF1493 !important;
  }
  
  .filter-inactive-primary:hover {
    box-shadow: 0 0 20px rgba(255, 20, 147, 0.4);
  }
  
  /* ===== FILTROS MODO CLARO ===== */
  :global([data-theme="light"]) .filter-active-primary {
    background: #FF1493 !important;
    color: white !important;
    border-color: #FF1493 !important;
    box-shadow: 0 0 15px rgba(255, 20, 147, 0.4);
  }

  :global([data-theme="light"]) .filter-inactive-primary {
    background: transparent !important;
    color: #FF1493 !important;
    border-color: #FF1493 !important;
  }
  
  :global([data-theme="light"]) .filter-inactive-primary:hover {
    box-shadow: 0 0 15px rgba(255, 20, 147, 0.3);
    background: rgba(255, 20, 147, 0.05) !important;
  }

  .filter-active-gluten {
    background: #FF6B6B !important;
    color: white !important;
    border-color: #FF6B6B !important;
    box-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
  }

  .filter-inactive-gluten {
    background: transparent !important;
    color: #FF6B6B !important;
    border-color: #FF6B6B !important;
  }
  
  .filter-inactive-gluten:hover {
    box-shadow: 0 0 20px rgba(255, 107, 107, 0.4);
  }

  .filter-active-featured {
    background: #FF0040 !important;
    color: white !important;
    border-color: #FF0040 !important;
    box-shadow: 0 0 20px rgba(255, 0, 64, 0.6);
  }

  .filter-inactive-featured {
    background: transparent !important;
    color: #FF0040 !important;
    border-color: #FF0040 !important;
  }
  
  .filter-inactive-featured:hover {
    box-shadow: 0 0 20px rgba(255, 0, 64, 0.4);
  }

  .filter-active-tourism {
    background: #FF8A80 !important;
    color: #1a1a1a !important;
    border-color: #FF8A80 !important;
    box-shadow: 0 0 20px rgba(255, 138, 128, 0.6);
  }

  .filter-inactive-tourism {
    background: transparent !important;
    color: #FF8A80 !important;
    border-color: #FF8A80 !important;
  }
  
  .filter-inactive-tourism:hover {
    box-shadow: 0 0 20px rgba(255, 138, 128, 0.4);
  }

  /* Stats Cards */
  .timeline-stat-card {
    background: rgba(255, 20, 147, 0.1);
    border: 1px solid rgba(255, 20, 147, 0.3);
    backdrop-filter: blur(10px);
  }
  
  .timeline-stat-card:hover {
    border-color: rgba(255, 20, 147, 0.5);
    box-shadow: 0 8px 32px rgba(255, 20, 147, 0.2);
  }
  
  :global([data-theme="light"]) .timeline-stat-card {
    background: rgba(255, 20, 147, 0.05);
    border: 1px solid rgba(255, 20, 147, 0.2);
  }
  
  :global([data-theme="light"]) .timeline-stat-card:hover {
    background: rgba(255, 20, 147, 0.1);
    border-color: rgba(255, 20, 147, 0.4);
  }

  .stat-label {
    color: rgba(255, 255, 255, 0.7);
  }
  
  :global([data-theme="light"]) .stat-label {
    color: rgba(80, 50, 80, 0.8);
  }

  /* CTA Button */
  .timeline-cta {
    background: linear-gradient(135deg, #FF6B6B, #FF1493);
    color: white;
    box-shadow: 0 4px 20px rgba(255, 20, 147, 0.4);
  }
  
  .timeline-cta:hover {
    box-shadow: 0 8px 30px rgba(255, 20, 147, 0.6);
  }

  /* Clickable Hint */
  .clickable-hint {
    color: rgba(255, 255, 255, 0.5);
  }
  
  .group-hover-indicator:hover .clickable-hint {
    color: #FF1493;
  }
  
  :global([data-theme="light"]) .clickable-hint {
    color: rgba(80, 50, 80, 0.6);
  }
  
  :global([data-theme="light"]) .group-hover-indicator:hover .clickable-hint {
    color: #FF1493;
  }

  /* Animaciones personalizadas para los filtros */
  [x-cloak] {
    display: none !important;
  }
</style>
